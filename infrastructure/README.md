# Infrastructure

This directory contains all infrastructure-related files for the Node.js application.

## Directory Structure

```
infrastructure/
├── docker/          # Docker configuration files
├── nginx/           # Nginx configuration
├── env/             # Environment variable templates
├── scripts/         # Infrastructure scripts
└── secrets/         # Docker secrets (not in version control)
```

## Docker Configuration

### Files in `docker/`:
- `Dockerfile` - Production Docker image
- `Dockerfile.dev` - Development Docker image with hot reload
- `docker-compose.yml` - Production environment
- `docker-compose.dev.yml` - Development environment
- `docker-compose.staging.yml` - Staging environment
- `docker-compose.prod.yml` - Production with Docker secrets
- `.dockerignore` - Files excluded from Docker build

### Usage:
```bash
# From project root
cd infrastructure/docker

# Development
docker-compose -f docker-compose.dev.yml up -d

# Staging
docker-compose -f docker-compose.staging.yml up -d

# Production
docker-compose -f docker-compose.yml up -d

# Production with secrets
docker-compose -f docker-compose.prod.yml up -d
```

## Nginx Configuration

### Files in `nginx/`:
- `nginx.conf` - Reverse proxy configuration with security headers

### Features:
- Security headers (XSS protection, frame options, etc.)
- Rate limiting (10 requests/second)
- Gzip compression
- Health check endpoint
- Proxy caching

## Environment Variables

### Files in `env/`:
- `env.example` - Production environment template
- `env.dev.example` - Development environment template
- `env.staging.example` - Staging environment template

### Setup:
```bash
# From project root
cp infrastructure/env/env.example .env
cp infrastructure/env/env.dev.example .env.dev
cp infrastructure/env/env.staging.example .env.staging
```

## Scripts

### Files in `scripts/`:
- `setup-env.sh` - Generate environment files with secure secrets
- `setup-secrets.sh` - Generate Docker secrets for production

### Usage:
```bash
# From project root
./infrastructure/scripts/setup-env.sh
./infrastructure/scripts/setup-secrets.sh
```

## Secrets

### Directory: `secrets/`
- Contains Docker secrets for production
- Not included in version control
- Generated by `setup-secrets.sh`

## Best Practices

1. **Environment Separation**: Different configs for dev/staging/prod
2. **Security**: Secrets not in version control
3. **Documentation**: Each component documented
4. **Modularity**: Separate concerns (Docker, Nginx, scripts)
5. **Reproducibility**: Scripts for consistent setup

## Ports

| Environment | Direct Access | Reverse Proxy |
|-------------|---------------|---------------|
| Development | 8000          | N/A           |
| Staging     | 8001          | 8080          |
| Production  | 8000          | 80/443        | 